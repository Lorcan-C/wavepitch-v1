{"version":3,"file":"index.js","sources":["../../src/GrowthBookReact.tsx"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport * as React from \"react\";\nimport type {\n  Experiment,\n  Result,\n  FeatureResult,\n  JSONValue,\n  FeatureDefinition,\n  Context,\n  WidenPrimitives,\n} from \"@growthbook/growthbook\";\nimport { GrowthBook } from \"@growthbook/growthbook\";\n\nexport type GrowthBookContextValue = {\n  growthbook: GrowthBook;\n};\nexport interface WithRunExperimentProps {\n  runExperiment: <T>(exp: Experiment<T>) => Result<T>;\n}\n/** @deprecated */\nexport type GrowthBookSSRData = {\n  attributes: Record<string, any>;\n  features: Record<string, FeatureDefinition>;\n};\n\nexport const GrowthBookContext = React.createContext<GrowthBookContextValue>(\n  {} as GrowthBookContextValue\n);\n\n/** @deprecated */\nexport async function getGrowthBookSSRData(\n  context: Context\n): Promise<GrowthBookSSRData> {\n  // Server-side GrowthBook instance\n  const gb = new GrowthBook({\n    ...context,\n  });\n\n  // Load feature flags from network if needed\n  if (context.clientKey) {\n    await gb.init();\n  }\n\n  const data: GrowthBookSSRData = {\n    attributes: gb.getAttributes(),\n    features: gb.getFeatures(),\n  };\n  gb.destroy();\n\n  return data;\n}\n\n/** @deprecated */\nexport function useGrowthBookSSR(data: GrowthBookSSRData) {\n  const gb = useGrowthBook();\n\n  // Only do this once to avoid infinite loops\n  const isFirst = React.useRef(true);\n  if (gb && isFirst.current) {\n    gb.setFeatures(data.features);\n    gb.setAttributes(data.attributes);\n    isFirst.current = false;\n  }\n}\n\nexport function useExperiment<T>(exp: Experiment<T>): Result<T> {\n  const { growthbook } = React.useContext(GrowthBookContext);\n  return growthbook.run(exp);\n}\n\nexport function useFeature<T extends JSONValue = any>(\n  id: string\n): FeatureResult<T | null> {\n  const growthbook = useGrowthBook();\n  return growthbook.evalFeature<T>(id);\n}\n\nexport function useFeatureIsOn<\n  AppFeatures extends Record<string, any> = Record<string, any>\n>(id: string & keyof AppFeatures): boolean {\n  const growthbook = useGrowthBook<AppFeatures>();\n  return growthbook.isOn(id);\n}\n\nexport function useFeatureValue<T extends JSONValue = any>(\n  id: string,\n  fallback: T\n): WidenPrimitives<T> {\n  const growthbook = useGrowthBook();\n  return growthbook.getFeatureValue(id, fallback);\n}\n\nexport function useGrowthBook<\n  AppFeatures extends Record<string, any> = Record<string, any>\n>(): GrowthBook<AppFeatures> {\n  const { growthbook } = React.useContext(GrowthBookContext);\n\n  if (!growthbook) {\n    throw new Error(\"Missing or invalid GrowthBookProvider\");\n  }\n\n  return growthbook as GrowthBook<AppFeatures>;\n}\n\nexport function FeaturesReady({\n  children,\n  timeout,\n  fallback,\n}: {\n  children: React.ReactNode;\n  timeout?: number;\n  fallback?: React.ReactNode;\n}): React.ReactElement {\n  const gb = useGrowthBook();\n  const [hitTimeout, setHitTimeout] = React.useState(false);\n  const ready = gb ? gb.ready : false;\n  React.useEffect(() => {\n    if (timeout && !ready) {\n      const timer = setTimeout(() => {\n        gb &&\n          gb.log(\"FeaturesReady timed out waiting for features to load\", {\n            timeout,\n          });\n        setHitTimeout(true);\n      }, timeout);\n      return () => clearTimeout(timer);\n    }\n  }, [timeout, ready, gb]);\n\n  return <>{ready || hitTimeout ? children : fallback || null}</>;\n}\n\nexport function IfFeatureEnabled({\n  children,\n  feature,\n}: {\n  children: React.ReactNode;\n  feature: string;\n}): React.ReactElement | null {\n  return useFeature(feature).on ? <>{children}</> : null;\n}\n\nexport function FeatureString(props: {\n  default: string;\n  feature: string;\n}): React.ReactElement {\n  const value = useFeature(props.feature).value;\n\n  if (value !== null) {\n    return <>{value}</>;\n  }\n\n  return <>{props.default}</>;\n}\n\nexport const withRunExperiment = <P extends WithRunExperimentProps>(\n  Component: React.ComponentType<P>\n): React.ComponentType<Omit<P, keyof WithRunExperimentProps>> => {\n  // eslint-disable-next-line\n  const withRunExperimentWrapper = (props: any): React.ReactElement => (\n    <GrowthBookContext.Consumer>\n      {({ growthbook }): React.ReactElement => {\n        return (\n          <Component\n            {...(props as P)}\n            runExperiment={(exp) => growthbook.run(exp)}\n          />\n        );\n      }}\n    </GrowthBookContext.Consumer>\n  );\n  return withRunExperimentWrapper;\n};\nwithRunExperiment.displayName = \"WithRunExperiment\";\n\nexport const GrowthBookProvider: React.FC<\n  React.PropsWithChildren<{\n    growthbook: GrowthBook;\n  }>\n> = ({ children, growthbook }) => {\n  // Tell growthbook how to re-render our app (for dev mode integration)\n  // eslint-disable-next-line\n  const [_, setRenderCount] = React.useState(0);\n  React.useEffect(() => {\n    if (!growthbook || !growthbook.setRenderer) return;\n\n    growthbook.setRenderer(() => {\n      setRenderCount((v) => v + 1);\n    });\n    return () => {\n      growthbook.setRenderer(() => {\n        // do nothing\n      });\n    };\n  }, [growthbook]);\n\n  return (\n    <GrowthBookContext.Provider\n      value={{\n        growthbook,\n      }}\n    >\n      {children}\n    </GrowthBookContext.Provider>\n  );\n};\n"],"names":["GrowthBookContext","React","createContext","getGrowthBookSSRData","context","gb","GrowthBook","clientKey","init","data","attributes","getAttributes","features","getFeatures","destroy","useGrowthBookSSR","useGrowthBook","isFirst","useRef","current","setFeatures","setAttributes","useExperiment","exp","growthbook","useContext","run","useFeature","id","evalFeature","useFeatureIsOn","isOn","useFeatureValue","fallback","getFeatureValue","Error","FeaturesReady","children","timeout","hitTimeout","setHitTimeout","useState","ready","useEffect","timer","setTimeout","log","clearTimeout","createElement","Fragment","IfFeatureEnabled","feature","on","FeatureString","props","value","default","withRunExperiment","Component","withRunExperimentWrapper","Consumer","_extends","runExperiment","displayName","GrowthBookProvider","_","setRenderCount","setRenderer","v","Provider"],"mappings":"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"}